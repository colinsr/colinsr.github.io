<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>AWS VPC | Colin's blog</title>
<meta name=keywords content="aws,amazon web services,VPC">
<meta name=description content="In this post we&rsquo;re going to dissect the make up of an AWS Virtual Private Cloud.
VPC&rsquo;s make up the networking component of Amazon Web Services. They&rsquo;re composed of several distinct pieces, we&rsquo;ll go over each one independently and talk about their purpose and some of the ins and outs of them.
 VPC Subnets Internet Gateway Route Tables Network Access Control Lists Security Groups Virtual Private Gatway VPC Endpoints  VPC  VPCs are the heart of AWS networking.">
<meta name=author content="Colin Detwiller">
<link rel=canonical href=https://colin.detwiller.me/posts/aws_vpc/>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.1e44d58192cbf6d7a4eb649bc43dbc3d4cc432677e5d8adc69b08c34cbe461ac.css integrity="sha256-HkTVgZLL9tek62SbxD28PUzEMmd+XYrcabCMNMvkYaw=" rel="preload stylesheet" as=style>
<link rel=icon href=https://colin.detwiller.me/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://colin.detwiller.me/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://colin.detwiller.me/favicon-32x32.png>
<link rel=apple-touch-icon href=https://colin.detwiller.me/apple-touch-icon.png>
<link rel=mask-icon href=https://colin.detwiller.me/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-70072280-3','auto'),ga('send','pageview'))</script><meta property="og:title" content="AWS VPC">
<meta property="og:description" content="In this post we&rsquo;re going to dissect the make up of an AWS Virtual Private Cloud.
VPC&rsquo;s make up the networking component of Amazon Web Services. They&rsquo;re composed of several distinct pieces, we&rsquo;ll go over each one independently and talk about their purpose and some of the ins and outs of them.
 VPC Subnets Internet Gateway Route Tables Network Access Control Lists Security Groups Virtual Private Gatway VPC Endpoints  VPC  VPCs are the heart of AWS networking.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://colin.detwiller.me/posts/aws_vpc/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-03-19T06:55:51-04:00">
<meta property="article:modified_time" content="2018-03-19T06:55:51-04:00"><meta property="og:site_name" content="talkdevopsto.me">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="AWS VPC">
<meta name=twitter:description content="In this post we&rsquo;re going to dissect the make up of an AWS Virtual Private Cloud.
VPC&rsquo;s make up the networking component of Amazon Web Services. They&rsquo;re composed of several distinct pieces, we&rsquo;ll go over each one independently and talk about their purpose and some of the ins and outs of them.
 VPC Subnets Internet Gateway Route Tables Network Access Control Lists Security Groups Virtual Private Gatway VPC Endpoints  VPC  VPCs are the heart of AWS networking.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://colin.detwiller.me/posts/"},{"@type":"ListItem","position":2,"name":"AWS VPC","item":"https://colin.detwiller.me/posts/aws_vpc/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS VPC","name":"AWS VPC","description":"In this post we\u0026rsquo;re going to dissect the make up of an AWS Virtual Private Cloud.\nVPC\u0026rsquo;s make up the networking component of Amazon Web Services. They\u0026rsquo;re composed of several distinct pieces, we\u0026rsquo;ll go over each one independently and talk about their purpose and some of the ins and outs of them.\n VPC Subnets Internet Gateway Route Tables Network Access Control Lists Security Groups Virtual Private Gatway VPC Endpoints  VPC  VPCs are the heart of AWS networking.","keywords":["aws","amazon web services","VPC"],"articleBody":"In this post we’re going to dissect the make up of an AWS Virtual Private Cloud.\nVPC’s make up the networking component of Amazon Web Services. They’re composed of several distinct pieces, we’ll go over each one independently and talk about their purpose and some of the ins and outs of them.\n VPC Subnets Internet Gateway Route Tables Network Access Control Lists Security Groups Virtual Private Gatway VPC Endpoints  VPC  VPCs are the heart of AWS networking.They enable you to create fully customized, fit to order virtual networks in the AWS cloud.While the power of VPCs in AWS is awesome, there are also a lot of pieces that fit together to form a VPC. We’ll go over each component separately in this post and try to make sense of all of this VPC talk.Bear in mind that a VPC can only live in one AWS Region, but it can span multiple Availability Zones.When the rubber meets the road, there are only a few things that a VPC needs in order to be created.First, it needs a name. Try to be descriptive here and give your VPC a meaningful, self documenting name. There’s nothing worse than seeing a VPC called vpc-1695 or some other garbage.Next up it, needs a CIDR block. CIDR stands for Classless Inter Domain Routing.What that means in layman’s terms is the VPC needs a range of private IP addresses which it has at it’s disposal. Take notice that I said “private” IP range.Back in the day, the Internet Engineering Task Force (IETF) realized that we were going to run out of public IP addresses, so they pulled several IP ranges and marked them as reserved for private networks. These private ranges fall into the following:\n 10.0.0.0 - 10.255.255.255 172.16.0.0 - 172.31.255.255 192.168.0.0 - 192.168.255.255  This means that if you are on the open internet and try to hit one of these private IP addresses you are pretty much S.O.L. as they are non-routable.There are a few limitations when it comes to the ranges you can provide a VPC in AWS. The netmask must be between /16 and /28. Pre CIDR notation used a Classful scheme where there were Class A, B, C, D, and E. I’m not going in to all the details of subnetting here, but we’ll cover enough to get our AWS VPC up and running.During setup of a VPC you can also choose whether or not to use IPv6, which is the follow up solution our friends at IETF came up with in regards to running out of IP addresses. We’ll have plenty of addresses to work with in our network, and I’d certainly rather be using 10.0.1.157/32 as an IP than 2001:db8:85a3:8d3:1319:8a2e:370:7348.The final input required for a VPC is the tenancy level. This is just talking about what kind of hardware you’d like your VPC to run your EC2 instances on. Dedicated Tenancy means running on an isolated server, where you are the only person using that server. It’s pretty expensive to run on Dedicated Tenancy, so we’ll stick with Default Tenancy unless we have a good reason not to.Default Tenancy means that our applications are not the only applications running on a given EC2 instance - there could be any number of other apps running alongside yours. Fear not, there is a hypervisor running on the host which handles the virtualization/isolation.This setting will override the EC2 Tenancy setting so proceed with caution if you choose Dedicated as all instances launched in your VPC will run in this mode.\nLet’s go through the console, and choose VPC from the services.Then we’ll navigate to Your VPCs and choose Create VPC. That will bring up a modal where we can enter some values.\nWe’ll choose a name Dev-VPC, a CIDR block 10.0.0.0/16, and a tenancy type Default and then click create. The /16 netmask will give our VPC access to over 65,000 private IP addresses, so I’d say we’re all good there.\nSubnets  Subnets have a long list of uses.They are primarily used to break up your VPC’s address range into smaller chunks. Amazon has multiple availability zones within a region and we’d like to distribute our servers across AZ’s in order to maximize high availability and fault tolerance. A subnet cannot span AZ’s so we’re going to need a few.In our 10.0.0.0/16 VPC example, we’d want to set up at least 2 subnets, one for each AZ. The second would get created in a different AZ than the first, let’s say us-east-2a and us-east-2b (yay Ohio data center).\nWhen you’re create your first subnet, go into the Subnets tab under the VPC service, and click on Create Subnet. We’ll provide a name public-1, the VPC to associate the subnet with Dev-VPC, the AZ to place the subnet, and the IPv4 CIDR block for the subnet. We’ll use a 10.0.1.0/24 block which will give us 256 addresses to play with from: 10.0.1.0 up to 10.0.1.255, minus the handful held back by AWS.\nAWS reserves the following addresses in each subnet inside a VPC - in our 10.0.1.0/16 VPC those will be:\n 10.0.1.0/32 = Network Address 10.0.1.1/32 = VPC router 10.0.1.2/32 = DNS server 10.0.1.3/32 = Reserved for \"future use\" 10.0.1.255/32 = Network Broadcast Address  This is what that looks like.\nNow repeat the same process - except that it’s in us-east-2b, the IPv4 CIDR block is 10.0.2.0/24 and the name is public-2. Nice!\nInternet Gateways  We created two “public” subnets, but in reality they are not connected to the internet and are public in name only.In order to make our subnets actually public we’ll need to create an Internet Gateway. These are used for all traffic to/from your network and the internet.You can only have one IGW attached to a VPC and we have none so let’s get to getting.\nGo into the Internet Gateways view and select Create Internet Gateway.Choose a name - Dev-VPC-IGW and click Yes, Create.\nOK, great we have an Internet Gateway now let’s get it connected to our VPC.Click on the Attach to VPC button and choose our Dev-VPC.\nRoute Tables  Which brings us to Route Tables. We now have a VPC, a couple subnets, added an Internet Gateway and still we need to give our subnets a route to the internet.A Route Table in AWS is pretty much the same as a router in an on premises network. Only 1 Route Table can be attached to a Subnet, but many subnets can be attached to the same route table.When a VPC is created, AWS creates a default Route Table along with it. Any new Subnets you create will automatically be attached to the default Route Table.This default Route Table only has one route defined - our local network (10.0.0.0/16).These Route Tables take 2 inputs, the Destination and the Target. Looking at our existing Default Route Table, we can see that we have a Destination which is the same as our CIDR block for our VPC and a target of local. No mention here of our Internet Gateway.In order to get our Subnets to be actually public, lets get the Internet Gateway attached to a new Route Table.Going in to our VPC service and Route Tables section we want to click on Create Route Table. Once the modal pops up we are going to give a clear name describing what this Route Table is for: Dev-VPC-Public sounds about right. Make sure you choose to create this new Route Table in the correct VPC in this step.\nWe’re already half way home. Now we just need to get a route added to pass non-local traffic off to the Internet Gateway.Back in the AWS Console, select your new Route Table, click on the Routes tab in the bottom dock and select Edit and finally Add another Route.Our next route is going to cover all non-local traffic. This is defined with Destination: 0.0.0.0/0, meaning when a computer on our VPC tries to access some IP address that does not reside in our VPC, our network is in the 10.0.0.0/16 IP address range, the traffic will be routed to the Internet Gateway.So now we just need to add the Target: Our IGW - which easily identifiable because of proper naming.\nDon’t forget to click the Save buton, and we can move on. We finally have proper public subnets.\nNetwork Access Control Lists (NACLs)  Ruh roh, now that our public Subnets are actually connected to the internet we’re going to have to start to think about locking them down so that we don’t expose ourselves to malicious attacks.AWS has multiple layers of securing your network/data, the first layer we’ll talk about is the Network Access Control List.NACLs control traffic at the Subnet level.A Subnet can only have one NACL attached to it at any given time, but once again, you can re-use NACLs on multiple Subnets.NACLs are stateless, meaning that if you have an explicit Inbound ALLOW rule, you must also have a corresponding explicit Outbound ALLOW rule in your configuration.These Rules are executed in ascending order, lower numbers are evaluated first, and once a Rule is hit no other Rules are evaluated.As per usual, AWS has been kind enough to create a default NACL for our VPC which has an ALL Traffic, ALL Protocol, ALL Port, allow Inbound and Outbound rule in place for traffic to/from all IPs.This is good for some folks, but we care about security so we’ll be creating a new custom NACL.Back in the AWS Console, in the VPC section, under the Security section we’ll choose Network ACLs.Once inside, we’ll choose Create Network ACL. Again we want to choose a meaningful name and make sure that we pick the correct VPC.\nWith the easy part out of the way, we can drill in to the Inbound/Outbound rules. First make sure you’ve selected our newly created NACL, then select Inbound Rules.It’s important to notice here that we have an explicit DENY ALL rule currently. We are going to have to specify exactly what traffic we want to allow into our public subnets.Select Edit, and Add another rule. Remember I said these rules are executed in ascending order? We need to give the rule a priority - let’s start at 100, Type - SSH (port 22 here), Protocol TCP, and Source - we’ll want to use our public IP to allow SSH access to our yet to be created instances.\nProtip: if you have curl installed you can use curl ipinfo.io to pull your public IP, otherwise Whats my ip.\nOur NACL wants your IP in CIDR notation, meaning that we need to toss a /32 on the end of our IP address to clarify that we only want to use our specific IP, not a range of IPs.While we’re at it let’s add Rule 110 to open up port 80 to the world, rule 120 to open up HTTPS to the world, and 130 to allow ephemeral traffic back in - this is for installing packages from our instances as the traffic doesn’t come back in over port 443.\nSince NACLs are stateless, let’s remember to update the outbound rules to allow the outbound traffic. Also, keep in mind that outbound traffic doesn’t always travel over the same port as inbound, it will also travel over ephemeral ports from 1024-65525.\nFinally, we just need to associate this new NACL with our public Subnets to complete the process.On the Subnet Associations tab, click edit and select both of our public subnets, then save.\nCongratulations, we’ve just allowed SSH traffic from our own IP and HTTP traffic from anyone.\nSecurity Groups (SGs)  Next up in our layered approach to VPC security are Security Groups.SGs are applied at the NIC (network interface card) level.It’s important to note that Security Groups are stateful, meaning that if you have add an inbound rule the corresponding outbound traffic will automatically be allowed.Let’s create a SG for the instances we plan to launch in our public Subnets.Again, from the AWS Console we navigate to the Security section, then Security Groups and click Create Security Group.Here we’re prompted for a name, group name, description and the target VPC.Dev-VPC-public-SG should clearly identify what we’re creating, so we’ll use that for Name and Group name.Give a brief description: Public Security Group, and choose our Dev-VPC.\nNext we’ll add a couple Inbound Rules.\nAnd we’re all set, now we just need to spin up some instances to use this Security Group and we should have traffic flowing just as we’d like.Remember that best practice is to only allow traffic that is required!\nVirtual Private Gateway  If you have a local on premises network then you’re going to want to get a Site to Site IPsec VPN tunnel set up between your local network and you AWS VPC.We are not going to configure this here, but you should at least be aware of the moving parts involved.These parts are:\n Customer Gateway VPN Connection Virtual Private Gateway  In order to configure a Site to Site VPN connectivity we’ll need to add a Customer Gateway which is the configuration of your local on prem network. This gets configured in your AWS VPC under the VPN Connections section of our VPC service in the AWS Console.We’ll also need to set up a Virtual Private Gateway, which is similar-ish to the Internet Gateway as it acts as the connector on the VPC side of the VPN connection.This is a bit hard to work through since most of us probably don’t have a networking lab setup at home.Although I’m thinking of doing a follow up post in the future on connecting an Azure VNET to an AWS VPC.\nVPC Endpoints  VPC Endpoints… ? What the heck are these?Well, many of the services AWS offers are web based, meaning that in order to hit an S3 bucket we would need to make a request over the open internet.What if we had sensitive data that we’d prefer to keep inside our network, you ask?This is where VPC Endpoints come into play. VPC Endpoints enable you to keep your requests to any of AWS' long list Endpoint supported services internal.Some prime examples would be DynamoDB, S3, KMS, Kinesis, and EC2 SSM.We’ll definitely be going into examples of VPC endpoints in a later post.\nSummary This is by far not an exhaustive list of all the features and capabilities of the AWS VPC, but this post is turning into a full day experience as is and what we’ve covered so far should be enough to get a very solid foundation of what VPCs are and what problem they accomplish.\n","wordCount":"2427","inLanguage":"en","datePublished":"2018-03-19T06:55:51-04:00","dateModified":"2018-03-19T06:55:51-04:00","author":{"@type":"Person","name":"Colin Detwiller"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://colin.detwiller.me/posts/aws_vpc/"},"publisher":{"@type":"Organization","name":"Colin's blog","logo":{"@type":"ImageObject","url":"https://colin.detwiller.me/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://colin.detwiller.me/ accesskey=h title="Colin's blog (Alt + H)">Colin's blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://colin.detwiller.me/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://colin.detwiller.me/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://colin.detwiller.me/>Home</a>&nbsp;»&nbsp;<a href=https://colin.detwiller.me/posts/>Posts</a></div>
<h1 class=post-title>
AWS VPC
</h1>
<div class=post-meta><span title="2018-03-19 06:55:51 -0400 -0400">March 19, 2018</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Colin Detwiller
</div>
</header>
<div class=post-content><p>In this post we&rsquo;re going to dissect the make up of an AWS Virtual Private Cloud.<br>
VPC&rsquo;s make up the networking component of Amazon Web Services.
They&rsquo;re composed of several distinct pieces, we&rsquo;ll go over each one independently and talk about their purpose and some of the ins and outs of them.</p>
<ul>
<li><a href=#vpc>VPC</a></li>
<li><a href=#subnet>Subnets</a></li>
<li><a href=#igw>Internet Gateway</a></li>
<li><a href=#routetable>Route Tables</a></li>
<li><a href=#nacl>Network Access Control Lists</a></li>
<li><a href=#sgs>Security Groups</a></li>
<li><a href=#vpg>Virtual Private Gatway</a></li>
<li><a href=#endpoints>VPC Endpoints</a></li>
</ul>
<h2 id=vpc-a-idvpca>VPC <a hidden class=anchor aria-hidden=true href=#vpc-a-idvpca>#</a></h2>
<p>VPCs are the heart of AWS networking.
They enable you to create fully customized, fit to order virtual networks in the AWS cloud.
While the power of VPCs in AWS is awesome, there are also a lot of pieces that fit together to form a VPC. We&rsquo;ll go over each component separately in this post and try to make sense of all of this VPC talk.
Bear in mind that a VPC can only live in one AWS Region, but it can span multiple Availability Zones.
When the rubber meets the road, there are only a few things that a VPC needs in order to be created.
First, it needs a name. Try to be descriptive here and give your VPC a meaningful, self documenting name. There&rsquo;s nothing worse than seeing a VPC called <code>vpc-1695</code> or some other garbage.
Next up it, needs a CIDR block. CIDR stands for Classless Inter Domain Routing.
What that means in layman&rsquo;s terms is the VPC needs a range of private IP addresses which it has at it&rsquo;s disposal. Take notice that I said &ldquo;private&rdquo; IP range.
Back in the day, the <a href=https://en.wikipedia.org/wiki/Internet_Engineering_Task_Force>Internet Engineering Task Force (IETF)</a> realized that we were going to run out of public IP addresses, so they pulled several IP ranges and marked them as reserved for private networks. These private ranges fall into the following:</p>
<ul>
<li>10.0.0.0 - 10.255.255.255</li>
<li>172.16.0.0 - 172.31.255.255</li>
<li>192.168.0.0 - 192.168.255.255</li>
</ul>
<p>This means that if you are on the open internet and try to hit one of these private IP addresses you are pretty much S.O.L. as they are non-routable.
There are a few limitations when it comes to the ranges you can provide a VPC in AWS. The netmask must be between <code>/16</code> and <code>/28</code>. Pre CIDR notation used a Classful scheme where there were Class A, B, C, D, and E. I&rsquo;m not going in to all the details of subnetting here, but we&rsquo;ll cover enough to get our AWS VPC up and running.
During setup of a VPC you can also choose whether or not to use IPv6, which is the follow up solution our friends at IETF came up with in regards to running out of IP addresses. We&rsquo;ll have plenty of addresses to work with in our network, and I&rsquo;d certainly rather be using <code>10.0.1.157/32</code> as an IP than <code>2001:db8:85a3:8d3:1319:8a2e:370:7348</code>.
The final input required for a VPC is the tenancy level. This is just talking about what kind of hardware you&rsquo;d like your VPC to run your EC2 instances on. Dedicated Tenancy means running on an isolated server, where you are the only person using that server. It&rsquo;s pretty expensive to run on Dedicated Tenancy, so we&rsquo;ll stick with Default Tenancy unless we have a good reason not to.
Default Tenancy means that our applications are not the only applications running on a given EC2 instance - there could be any number of other apps running alongside yours. Fear not, there is a hypervisor running on the host which handles the virtualization/isolation.
This setting will override the EC2 Tenancy setting so proceed with caution if you choose Dedicated as all instances launched in your VPC will run in this mode.</p>
<p>Let&rsquo;s go through the console, and choose VPC from the services.
Then we&rsquo;ll navigate to <code>Your VPCs</code> and choose <code>Create VPC</code>. That will bring up a modal where we can enter some values.</p>
<p><img loading=lazy src=/img/VPC_create.png alt="Create VPC">
</p>
<p>We&rsquo;ll choose a name <code>Dev-VPC</code>, a CIDR block <code>10.0.0.0/16</code>, and a tenancy type <code>Default</code> and then click create. The <code>/16</code> netmask will give our VPC access to over 65,000 private IP addresses, so I&rsquo;d say we&rsquo;re all good there.</p>
<h2 id=subnets-a-idsubneta>Subnets <a hidden class=anchor aria-hidden=true href=#subnets-a-idsubneta>#</a></h2>
<p>Subnets have a long list of uses.
They are primarily used to break up your VPC&rsquo;s address range into smaller chunks. Amazon has multiple availability zones within a region and we&rsquo;d like to distribute our servers across AZ&rsquo;s in order to maximize high availability and fault tolerance. A subnet cannot span AZ&rsquo;s so we&rsquo;re going to need a few.
In our <code>10.0.0.0/16</code> VPC example, we&rsquo;d want to set up at least 2 subnets, one for each AZ. The second would get created in a different AZ than the first, let&rsquo;s say <code>us-east-2a</code> and <code>us-east-2b</code> (yay Ohio data center).</p>
<p>When you&rsquo;re create your first subnet, go into the Subnets tab under the VPC service, and click on Create Subnet. We&rsquo;ll provide a name <code>public-1</code>, the VPC to associate the subnet with <code>Dev-VPC</code>, the AZ to place the subnet, and the IPv4 CIDR block for the subnet. We&rsquo;ll use a <code>10.0.1.0/24</code> block which will give us 256 addresses to play with from: <code>10.0.1.0</code> up to <code>10.0.1.255</code>, minus the handful held back by AWS.</p>
<p>AWS reserves the following addresses in <strong>each</strong> subnet inside a VPC - in our <code>10.0.1.0/16</code> VPC those will be:</p>
<ul>
<li><code>10.0.1.0/32</code> => <code>Network Address</code></li>
<li><code>10.0.1.1/32</code> => <code>VPC router</code></li>
<li><code>10.0.1.2/32</code> => <code>DNS server</code></li>
<li><code>10.0.1.3/32</code> => <code>Reserved for "future use"</code></li>
<li><code>10.0.1.255/32</code> => <code>Network Broadcast Address</code></li>
</ul>
<p>This is what that looks like.</p>
<p><img loading=lazy src=/img/VPC_subnet.png alt="Create Subnet">
</p>
<p>Now repeat the same process - except that it&rsquo;s in <code>us-east-2b</code>, the IPv4 CIDR block is <code>10.0.2.0/24</code> and the name is <code>public-2</code>. Nice!</p>
<h2 id=internet-gateways-a-idigwa>Internet Gateways <a hidden class=anchor aria-hidden=true href=#internet-gateways-a-idigwa>#</a></h2>
<p>We created two &ldquo;public&rdquo; subnets, but in reality they are not connected to the internet and are public in name only.
In order to make our subnets actually public we&rsquo;ll need to create an Internet Gateway. These are used for all traffic to/from your network and the internet.
You can only have one IGW attached to a VPC and we have none so let&rsquo;s get to getting.</p>
<p>Go into the <code>Internet Gateways</code> view and select Create Internet Gateway.
Choose a name - <code>Dev-VPC-IGW</code> and click Yes, Create.</p>
<p><img loading=lazy src=/img/VPC_igw.png alt="Create Internet Gateway">
</p>
<p>OK, great we have an Internet Gateway now let&rsquo;s get it connected to our VPC.
Click on the Attach to VPC button and choose our <code>Dev-VPC</code>.</p>
<h2 id=route-tables-a-idroutetablea>Route Tables <a hidden class=anchor aria-hidden=true href=#route-tables-a-idroutetablea>#</a></h2>
<p>Which brings us to Route Tables. We now have a VPC, a couple subnets, added an Internet Gateway and still we need to give our subnets a route to the internet.
A Route Table in AWS is pretty much the same as a router in an on premises network. Only 1 Route Table can be attached to a Subnet, but many subnets can be attached to the same route table.
When a VPC is created, AWS creates a default Route Table along with it. Any new Subnets you create will automatically be attached to the default Route Table.
This default Route Table only has one route defined - our local network (<code>10.0.0.0/16</code>).
These Route Tables take 2 inputs, the Destination and the Target. Looking at our existing Default Route Table, we can see that we have a Destination which is the same as our CIDR block for our VPC and a target of local. No mention here of our Internet Gateway.
In order to get our Subnets to be actually public, lets get the Internet Gateway attached to a new Route Table.
Going in to our VPC service and Route Tables section we want to click on Create Route Table. Once the modal pops up we are going to give a clear name describing what this Route Table is for: <code>Dev-VPC-Public</code> sounds about right. Make sure you choose to create this new Route Table in the correct VPC in this step.</p>
<p><img loading=lazy src=/img/VPC_route_table.png alt="Create Route Table">
</p>
<p>We&rsquo;re already half way home. Now we just need to get a route added to pass non-local traffic off to the Internet Gateway.
Back in the AWS Console, select your new Route Table, click on the Routes tab in the bottom dock and select Edit and finally Add another Route.
Our next route is going to cover all non-local traffic. This is defined with <code>Destination: 0.0.0.0/0</code>, meaning when a computer on our VPC tries to access some IP address that does not reside in our VPC, our network is in the <code>10.0.0.0/16</code> IP address range, the traffic will be routed to the Internet Gateway.
So now we just need to add the <code>Target: Our IGW</code> - which easily identifiable because of proper naming.</p>
<p><img loading=lazy src=/img/VPC_public_route.png alt="Create Public Route">
</p>
<p>Don&rsquo;t forget to click the Save buton, and we can move on. We finally have proper public subnets.</p>
<h2 id=network-access-control-lists-nacls-a-idnacla>Network Access Control Lists (NACLs) <a hidden class=anchor aria-hidden=true href=#network-access-control-lists-nacls-a-idnacla>#</a></h2>
<p>Ruh roh, now that our public Subnets are actually connected to the internet we&rsquo;re going to have to start to think about locking them down so that we don&rsquo;t expose ourselves to malicious attacks.
AWS has multiple layers of securing your network/data, the first layer we&rsquo;ll talk about is the Network Access Control List.
NACLs control traffic at the Subnet level.
A Subnet can only have one NACL attached to it at any given time, but once again, you can re-use NACLs on multiple Subnets.
NACLs are stateless, meaning that if you have an explicit Inbound ALLOW rule, <strong>you must</strong> also have a corresponding explicit Outbound ALLOW rule in your configuration.
These Rules are executed in ascending order, lower numbers are evaluated first, and once a Rule is hit no other Rules are evaluated.
As per usual, AWS has been kind enough to create a default NACL for our VPC which has an ALL Traffic, ALL Protocol, ALL Port, allow Inbound and Outbound rule in place for traffic to/from all IPs.
This is good for some folks, but we care about security so we&rsquo;ll be creating a new custom NACL.
Back in the AWS Console, in the VPC section, under the Security section we&rsquo;ll choose Network ACLs.
Once inside, we&rsquo;ll choose Create Network ACL. Again we want to choose a meaningful name and make sure that we pick the correct VPC.</p>
<p><img loading=lazy src=/img/VPC_NACL.png alt="Create Network ACL">
</p>
<p>With the easy part out of the way, we can drill in to the Inbound/Outbound rules. First make sure you&rsquo;ve selected our newly created NACL, then select Inbound Rules.
It&rsquo;s important to notice here that we have an explicit DENY ALL rule currently. We are going to have to specify exactly what traffic we want to allow into our public subnets.
Select Edit, and Add another rule. Remember I said these rules are executed in ascending order? We need to give the rule a priority - let&rsquo;s start at 100, Type - SSH (port 22 here), Protocol TCP, and Source - we&rsquo;ll want to use our public IP to allow SSH access to our yet to be created instances.</p>
<p>Protip: if you have curl installed you can use <code>curl ipinfo.io</code> to pull your public IP, otherwise <a href=https://whatsmyip.com/>Whats my ip</a>.</p>
<p>Our NACL wants your IP in CIDR notation, meaning that we need to toss a <code>/32</code> on the end of our IP address to clarify that we only want to use our specific IP, not a range of IPs.
While we&rsquo;re at it let&rsquo;s add Rule 110 to open up port 80 to the world, rule 120 to open up HTTPS to the world, and 130 to allow ephemeral traffic back in - this is for installing packages from our instances as the traffic doesn&rsquo;t come back in over port 443.</p>
<p><img loading=lazy src=/img/VPC_NACL_inbound.png alt="Network ACL Inbound">
</p>
<p>Since NACLs are stateless, let&rsquo;s remember to update the outbound rules to allow the outbound traffic. Also, keep in mind that outbound traffic doesn&rsquo;t always travel over the same port as inbound, it will also travel over ephemeral ports from 1024-65525.</p>
<p><img loading=lazy src=/img/VPC_NACL_outbound.png alt="Network ACL Outbound">
</p>
<p>Finally, we just need to associate this new NACL with our public Subnets to complete the process.
On the Subnet Associations tab, click edit and select both of our public subnets, then save.</p>
<p>Congratulations, we&rsquo;ve just allowed SSH traffic from our own IP and HTTP traffic from anyone.</p>
<h2 id=security-groups-sgs-a-idsgsa>Security Groups (SGs) <a hidden class=anchor aria-hidden=true href=#security-groups-sgs-a-idsgsa>#</a></h2>
<p>Next up in our layered approach to VPC security are Security Groups.
SGs are applied at the NIC (network interface card) level.
It&rsquo;s important to note that Security Groups are stateful, meaning that if you have add an inbound rule the corresponding outbound traffic will automatically be allowed.
Let&rsquo;s create a SG for the instances we plan to launch in our public Subnets.
Again, from the AWS Console we navigate to the Security section, then Security Groups and click Create Security Group.
Here we&rsquo;re prompted for a name, group name, description and the target VPC.
<code>Dev-VPC-public-SG</code> should clearly identify what we&rsquo;re creating, so we&rsquo;ll use that for Name and Group name.
Give a brief description: <code>Public Security Group</code>, and choose our Dev-VPC.</p>
<p><img loading=lazy src=/img/VPC_Security_Group.png alt="Security Group">
</p>
<p>Next we&rsquo;ll add a couple Inbound Rules.</p>
<p><img loading=lazy src=/img/VPC_SG_Inbound.png alt="Security Group Inbound">
</p>
<p>And we&rsquo;re all set, now we just need to spin up some instances to use this Security Group and we should have traffic flowing just as we&rsquo;d like.
<strong>Remember that best practice is to only allow traffic that is required!</strong></p>
<h2 id=virtual-private-gateway-a-idvpga>Virtual Private Gateway <a hidden class=anchor aria-hidden=true href=#virtual-private-gateway-a-idvpga>#</a></h2>
<p>If you have a local on premises network then you&rsquo;re going to want to get a Site to Site IPsec VPN tunnel set up between your local network and you AWS VPC.
We are not going to configure this here, but you should at least be aware of the moving parts involved.
These parts are:</p>
<ul>
<li>Customer Gateway</li>
<li>VPN Connection</li>
<li>Virtual Private Gateway</li>
</ul>
<p>In order to configure a Site to Site VPN connectivity we&rsquo;ll need to add a Customer Gateway which is the configuration of your local on prem network. This gets configured in your AWS VPC under the VPN Connections section of our VPC service in the AWS Console.
We&rsquo;ll also need to set up a Virtual Private Gateway, which is similar-ish to the Internet Gateway as it acts as the connector on the VPC side of the VPN connection.
This is a bit hard to work through since most of us probably don&rsquo;t have a networking lab setup at home.
Although I&rsquo;m thinking of doing a follow up post in the future on connecting an Azure VNET to an AWS VPC.</p>
<h2 id=vpc-endpoints-a-idendpointsa>VPC Endpoints <a hidden class=anchor aria-hidden=true href=#vpc-endpoints-a-idendpointsa>#</a></h2>
<p>VPC Endpoints&mldr; ? What the heck are these?
Well, many of the services AWS offers are web based, meaning that in order to hit an S3 bucket we would need to make a request over the open internet.
What if we had sensitive data that we&rsquo;d prefer to keep <em>inside</em> our network, you ask?
This is where VPC Endpoints come into play. VPC Endpoints enable you to keep your requests to any of AWS' long list Endpoint supported services internal.
Some prime examples would be DynamoDB, S3, KMS, Kinesis, and EC2 SSM.
We&rsquo;ll definitely be going into examples of VPC endpoints in a later post.</p>
<h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2>
<p>This is by far not an exhaustive list of all the features and capabilities of the AWS VPC, but this post is turning into a full day experience as is and what we&rsquo;ve covered so far should be enough to get a very solid foundation of what VPCs are and what problem they accomplish.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://colin.detwiller.me/tags/aws/>aws</a></li>
<li><a href=https://colin.detwiller.me/tags/amazon-web-services/>amazon web services</a></li>
<li><a href=https://colin.detwiller.me/tags/vpc/>VPC</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://colin.detwiller.me/posts/aws_ec2/>
<span class=title>« Prev Page</span>
<br>
<span>AWS EC2</span>
</a>
<a class=next href=https://colin.detwiller.me/posts/aws_iam/>
<span class=title>Next Page »</span>
<br>
<span>AWS Identity & Access Management</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share AWS VPC on twitter" href="https://twitter.com/intent/tweet/?text=AWS%20VPC&url=https%3a%2f%2fcolin.detwiller.me%2fposts%2faws_vpc%2f&hashtags=aws%2camazonwebservices%2cVPC"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share AWS VPC on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcolin.detwiller.me%2fposts%2faws_vpc%2f&title=AWS%20VPC&summary=AWS%20VPC&source=https%3a%2f%2fcolin.detwiller.me%2fposts%2faws_vpc%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share AWS VPC on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fcolin.detwiller.me%2fposts%2faws_vpc%2f&title=AWS%20VPC"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share AWS VPC on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fcolin.detwiller.me%2fposts%2faws_vpc%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share AWS VPC on whatsapp" href="https://api.whatsapp.com/send?text=AWS%20VPC%20-%20https%3a%2f%2fcolin.detwiller.me%2fposts%2faws_vpc%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share AWS VPC on telegram" href="https://telegram.me/share/url?text=AWS%20VPC&url=https%3a%2f%2fcolin.detwiller.me%2fposts%2faws_vpc%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://colin.detwiller.me/>Colin's blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>